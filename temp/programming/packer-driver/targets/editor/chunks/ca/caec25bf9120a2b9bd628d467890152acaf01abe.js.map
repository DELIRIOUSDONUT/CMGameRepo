{"version":3,"sources":["file:///Users/admin/Documents/GitHub/CMGameRepo/assets/Scripts/CardController.ts"],"names":["shuffleArray","array","currentIndex","length","randomIndex","Math","floor","random","_decorator","Component","instantiate","Layout","Prefab","CCInteger","ccclass","property","CardController","type","tooltip","ScoreEval","CardSelectedQueue","NumSelectedCards","ScoreCounter","SaveState","score","combo","cards","faceUpIndex","removedCards","columnReq","childCardHeight","childCardWidth","ColumnReq","onLoad","getCardSize","start","node","getComponent","localStorage","getItem","console","log","JSON","parse","NumCards","Score","ComboStreak","i","childCard","CardPrefab","childTransform","width","height","addChild","cardScript","children","init","setFlipStatus","disable","setupCardMatchListener","shuffledTypes","getCardTypes","widget","target","push","update","deltaTime","testGetChildren","forEach","childNode","name","CardType","FlippedUp","Array","on","event","card","propagationStopped","CardID","getScore","trackScore","shift","every","val","removeItem","setItem","stringify","scoringTypes","from","scoreHashMap","keys","numTypes","parentLayout","parentTransform","parentWidth","contentSize","parentHeight","constraint","Constraint","FIXED_COL","numCols","constraintNum","spacingX","numRows","ceil","spacingY"],"mappings":";;;;;;;;;;;AA2QA;AACA,WAASA,YAAT,CAAyBC,KAAzB,EAA0C;AACtC,QAAIC,YAAY,GAAGD,KAAK,CAACE,MAAzB;AAAA,QAAiCC,WAAjC,CADsC,CAGtC;;AACA,WAAOF,YAAY,KAAK,CAAxB,EAA2B;AAEzB;AACAE,MAAAA,WAAW,GAAGC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAgBL,YAA3B,CAAd;AACAA,MAAAA,YAAY,GAJa,CAMzB;;AACA,OAACD,KAAK,CAACC,YAAD,CAAN,EAAsBD,KAAK,CAACG,WAAD,CAA3B,IAA4C,CAC1CH,KAAK,CAACG,WAAD,CADqC,EACtBH,KAAK,CAACC,YAAD,CADiB,CAA5C;AAED;;AAED,WAAOD,KAAP;AACD;;;;;;;;;;;;;;;;;;;;;;;;;AA5RMO,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,M,OAAAA,M;AAAcC,MAAAA,M,OAAAA,M;AAClDC,MAAAA,S,OAAAA,S;;;;;;;;;;;OAKH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBP,U;;gCAGjBQ,c,WADZF,OAAO,CAAC,gBAAD,C,UAEHC,QAAQ,CAAC;AAACE,QAAAA,IAAI,EAAEL,MAAP;AAAeM,QAAAA,OAAO,EAAE;AAAxB,OAAD,C,UAGRH,QAAQ,CAAC;AAACE,QAAAA,IAAI,EAAEJ,SAAP;AAAkBK,QAAAA,OAAO,EAAE;AAA3B,OAAD,C,2BALb,MACaF,cADb,SACoCP,SADpC,CAC8C;AAAA;AAAA;;AAAA;;AAAA;;AAAA,eAO1CU,SAP0C;AAS1C;AACA;AAV0C,eAW1CC,iBAX0C;AAa1C;AAb0C,eAc1CC,gBAd0C;AAgB1C;AACA;AACA;AAEA;AApB0C,eAqB1CC,YArB0C;AAAA,eAuB1CC,SAvB0C,GAuB9B;AACRC,YAAAA,KAAK,EAAE,CADC;AAERC,YAAAA,KAAK,EAAE,CAFC;AAGRC,YAAAA,KAAK,EAAG,EAHA;AAIRC,YAAAA,WAAW,EAAE,CAAC,CAJN;AAKRC,YAAAA,YAAY,EAAG,EALP;AAMRC,YAAAA,SAAS,EAAE;AANH,WAvB8B;AAAA,eAgC1CC,eAhC0C;AAAA,eAiC1CC,cAjC0C;AAAA,eAmC1CC,SAnC0C;AAAA;;AAqChCC,QAAAA,MAAM,GAAS;AACrB,eAAKC,WAAL;AACH;;AACDC,QAAAA,KAAK,GAAG;AACJ;AACA,eAAKD,WAAL,GAFI,CAGJ;;AACA,eAAKf,SAAL,GAAiB,KAAKiB,IAAL,CAAUC,YAAV,CAAuB,gBAAvB,CAAjB,CAJI,CAKJ;;AACA,eAAKf,YAAL,GAAoB,KAAKc,IAAL,CAAUC,YAAV,CAAuB,cAAvB,CAApB,CANI,CAOJ;;AACA,cAAIC,YAAY,CAACC,OAAb,CAAqB,WAArB,CAAJ,EAAwC;AACpCC,YAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ;AACA,iBAAKlB,SAAL,GAAiBmB,IAAI,CAACC,KAAL,CAAWL,YAAY,CAACC,OAAb,CAAqB,WAArB,CAAX,CAAjB;;AACA,gBAAG,KAAKhB,SAAL,CAAeM,SAAf,IAA4B,KAAKG,SAApC,EAA8C;AAC1CQ,cAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ;AACA,mBAAKP,WAAL;AACH,aAHD,MAGO,IAAG,KAAKX,SAAL,CAAeG,KAAf,CAAqBvB,MAArB,IAA+B,KAAKyC,QAAvC,EAAgD;AACnDJ,cAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ;AACA,mBAAKP,WAAL;AACH,aAHM,MAGA;AACH;AACA,mBAAKU,QAAL,GAAgB,KAAKrB,SAAL,CAAeG,KAAf,CAAqBvB,MAArC;AACA,mBAAKmB,YAAL,CAAkBuB,KAAlB,GAA0B,KAAKtB,SAAL,CAAeC,KAAzC;AACA,mBAAKF,YAAL,CAAkBwB,WAAlB,GAAgC,KAAKvB,SAAL,CAAeE,KAA/C;;AACA,mBAAI,IAAIsB,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG,KAAKH,QAAxB,EAAkCG,CAAC,EAAnC,EAAsC;AAClC,sBAAMC,SAAS,GAAGtC,WAAW,CAAC,KAAKuC,UAAN,CAA7B;AACA,oBAAIC,cAA4B,GAC5BF,SAAS,CAACX,YAAV,CAAuB,gBAAvB,CADJ;AAEAa,gBAAAA,cAAc,CAACC,KAAf,GAAuB,KAAKpB,cAA5B;AACAmB,gBAAAA,cAAc,CAACE,MAAf,GAAwB,KAAKtB,eAA7B;AACA,qBAAKM,IAAL,CAAUiB,QAAV,CAAmBL,SAAnB;AACA,oBAAIM,UAAuB,GACvB,KAAKlB,IAAL,CAAUmB,QAAV,CAAmBR,CAAnB,EAAsBV,YAAtB,CAAmC,YAAnC,CADJ;AAEAiB,gBAAAA,UAAU,CAACE,IAAX,CAAgB,KAAhB,EAAuB,KAAKjC,SAAL,CAAeG,KAAf,CAAqBqB,CAArB,CAAvB,EAAgDA,CAAhD;;AACA,oBAAG,KAAKxB,SAAL,CAAeI,WAAf,IAA8BoB,CAAjC,EAAmC;AAC/BO,kBAAAA,UAAU,CAACG,aAAX,CAAyB,IAAzB;AACH;;AACD,oBAAG,KAAKlC,SAAL,CAAeK,YAAf,CAA4BmB,CAA5B,KAAkC,CAArC,EAAuC;AACnCO,kBAAAA,UAAU,CAACI,OAAX;AACH;AACH,eArBC,CAsBF;;;AACD,mBAAKC,sBAAL;AACA;AACH;AACJ,WA3CG,CA6CJ;;;AACA,cAAG,KAAKf,QAAL,GAAgB,CAAhB,IAAqB,CAAxB,EAA0B;AACtB,iBAAKA,QAAL,IAAiB,CAAjB;AACH,WAhDG,CAmDJ;;;AACA,cAAIgB,aAA6B,GAAG,KAAKC,YAAL,EAApC,CApDI,CAsDJ;;AACA,eAAK,IAAId,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKH,QAAzB,EAAmCG,CAAC,EAApC,EAAuC;AACnC,kBAAMC,SAAS,GAAGtC,WAAW,CAAC,KAAKuC,UAAN,CAA7B;AACA,gBAAIC,cAA4B,GAC5BF,SAAS,CAACX,YAAV,CAAuB,gBAAvB,CADJ;AAEAa,YAAAA,cAAc,CAACC,KAAf,GAAuB,KAAKpB,cAA5B;AACAmB,YAAAA,cAAc,CAACE,MAAf,GAAwB,KAAKtB,eAA7B;AACA,iBAAKM,IAAL,CAAUiB,QAAV,CAAmBL,SAAnB;AACA,gBAAIM,UAAuB,GACnBN,SAAS,CAACX,YAAV,CAAuB,YAAvB,CADR;AAGAiB,YAAAA,UAAU,CAACE,IAAX,CAAgB,KAAhB,EAAuBI,aAAa,CAACb,CAAD,CAApC,EAAyCA,CAAzC,EAVmC,CAWnC;;AACA,gBAAIe,MAAe,GACXd,SAAS,CAACX,YAAV,CAAuB,WAAvB,CADR;AAEAyB,YAAAA,MAAM,CAACC,MAAP,GAAgB,KAAK3B,IAArB,CAdmC,CAgBnC;;AACA,iBAAKb,SAAL,CAAeG,KAAf,CAAqBsC,IAArB,CAA0BJ,aAAa,CAACb,CAAD,CAAvC;AACA,iBAAKxB,SAAL,CAAeK,YAAf,CAA4BoC,IAA5B,CAAiC,CAAjC;AACH,WA1EG,CA4EJ;;;AACA,eAAKL,sBAAL;AACH;;AAEDM,QAAAA,MAAM,CAACC,SAAD,EAAoB,CACzB;;AAEDC,QAAAA,eAAe,GAAE;AACb,eAAK/B,IAAL,CAAUmB,QAAV,CAAmBa,OAAnB,CAA2BC,SAAS,IAAG;AACnC7B,YAAAA,OAAO,CAACC,GAAR,CAAY4B,SAAS,CAACC,IAAtB;AACA,gBAAIhB,UAAuB,GACfe,SAAS,CAAChC,YAAV,CAAuB,YAAvB,CADZ;;AAEA,gBAAGiB,UAAH,EAAc;AACVd,cAAAA,OAAO,CAACC,GAAR,CAAYa,UAAU,CAACiB,QAAvB,EAAiCjB,UAAU,CAACkB,SAA5C;AACH;AAEJ,WARD;AASH;;AAEDb,QAAAA,sBAAsB,GAAE;AACpB,eAAKvC,iBAAL,GAAyB,IAAIqD,KAAJ,EAAzB;AACA,eAAKpD,gBAAL,GAAwB,CAAxB;AACA,eAAKe,IAAL,CAAUsC,EAAV,CAAa,eAAb,EAA+BC,KAAD,IAA6B;AACvD,gBAAIC,IAAiB,GAAGD,KAAK,CAACC,IAA9B,CADuD,CAEvD;;AACAD,YAAAA,KAAK,CAACE,kBAAN,GAA2B,IAA3B;AACArC,YAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ,EAAkCmC,IAAI,CAACE,MAAvC,EAA+C,cAA/C,EAA8DF,IAAI,CAACL,QAAnE,EAJuD,CAKvD;AAEA;;AACA,gBAAGK,IAAI,CAACJ,SAAR,EAAkB;AACd;AACH,aAVsD,CAWvD;;;AACA,iBAAKpD,iBAAL,CAAuB4C,IAAvB,CAA4BY,IAA5B;AACA,iBAAKvD,gBAAL,GAbuD,CAcvD;;AACA,gBAAG,KAAKA,gBAAL,IAAyB,CAA5B,EAA8B;AAC1B;AACAuD,cAAAA,IAAI,CAACnB,aAAL,CAAmB,IAAnB;AACA,mBAAKlC,SAAL,CAAeI,WAAf,GAA6BiD,IAAI,CAACE,MAAlC,CAH0B,CAGgB;AAC7C,aAJD,MAIO,IAAI,KAAKzD,gBAAL,GAAwB,CAA5B,EAA8B;AACjC;AACA,mBAAKE,SAAL,CAAeI,WAAf,GAA6B,CAAC,CAA9B;AACAiD,cAAAA,IAAI,CAACnB,aAAL,CAAmB,IAAnB;AACA,kBAAIjC,KAAc,GAAG,KAAKL,SAAL,CAAe4D,QAAf,CACjB,KAAK3D,iBAAL,CAAuB,CAAvB,EAA0BmD,QADT,EAEjBK,IAAI,CAACL,QAFY,CAArB;AAIA/B,cAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAuBjB,KAAvB,EARiC,CAUjC;;AACA,mBAAKF,YAAL,CAAkB0D,UAAlB,CAA6BxD,KAA7B,EAXiC,CAYjC;;AACA,mBAAKD,SAAL,CAAeC,KAAf,GAAuB,KAAKF,YAAL,CAAkBuB,KAAzC;AACA,mBAAKtB,SAAL,CAAeE,KAAf,GAAuB,KAAKH,YAAL,CAAkBwB,WAAzC,CAdiC,CAejC;;AACA,kBAAGtB,KAAK,IAAI,CAAZ,EAAc;AACV;AACA,qBAAKD,SAAL,CAAeE,KAAf,GAAuB,CAAvB,CAFU,CAGV;;AACA,qBAAKL,iBAAL,CAAuB,CAAvB,EAA0BqC,aAA1B,CAAwC,KAAxC;AACAmB,gBAAAA,IAAI,CAACnB,aAAL,CAAmB,KAAnB;AAEH,eAPD,MAOO;AACH;AAEA;AACA,qBAAKrC,iBAAL,CAAuB,CAAvB,EAA0BsC,OAA1B;AACAkB,gBAAAA,IAAI,CAAClB,OAAL,GALG,CAOH;;AACA,qBAAKnC,SAAL,CAAeK,YAAf,CAA4B,KAAKR,iBAAL,CAAuB,CAAvB,EAA0B0D,MAAtD,IAAgE,CAAhE;AACA,qBAAKvD,SAAL,CAAeK,YAAf,CAA4BgD,IAAI,CAACE,MAAjC,IAA2C,CAA3C;AACH,eAjCgC,CAkCjC;;;AACA,mBAAKzD,gBAAL,IAAyB,CAAzB;AACA,mBAAKD,iBAAL,CAAuB6D,KAAvB;AACA,mBAAK7D,iBAAL,CAAuB6D,KAAvB;AAEH,aAvCM,MAuCA;AACHzC,cAAAA,OAAO,CAACC,GAAR,CAAY,6BAAZ,EAA2C,KAAKpB,gBAAhD;AACH;;AACDmB,YAAAA,OAAO,CAACC,GAAR,CAAY,KAAKlB,SAAjB,EA7DuD,CA+DvD;;AACA,gBAAG,KAAKA,SAAL,CAAeK,YAAf,CAA4BsD,KAA5B,CAAmCC,GAAD,IAASA,GAAG,IAAI,CAAlD,CAAH,EAAwD;AACpD7C,cAAAA,YAAY,CAAC8C,UAAb,CAAwB,WAAxB;AACH,aAFD,MAEO;AACH9C,cAAAA,YAAY,CAAC+C,OAAb,CAAqB,WAArB,EAAkC3C,IAAI,CAAC4C,SAAL,CAAe,KAAK/D,SAApB,CAAlC;AACH;AACJ,WArED;AAsEH;;AAEDsC,QAAAA,YAAY,GAAkB;AAC1B;AACA,cAAI0B,YAA4B,GAAGd,KAAK,CAACe,IAAN,CAAW,KAAKrE,SAAL,CAAesE,YAAf,CAA4BC,IAA5B,EAAX,CAAnC;AACAH,UAAAA,YAAY,GAAGvF,YAAY,CAACuF,YAAD,CAA3B;AACA/C,UAAAA,OAAO,CAACC,GAAR,CAAY8C,YAAZ;AACA,cAAII,QAAiB,GAAG,KAAK/C,QAAL,GAAgB,CAAxC;AACA,cAAIgB,aAA6B,GAAG,IAAIa,KAAJ,EAApC,CAN0B,CAO1B;;AACAjC,UAAAA,OAAO,CAACC,GAAR,CAAYmB,aAAZ;;AACA,eAAI,IAAIb,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG4C,QAAnB,EAA6B5C,CAAC,EAA9B,EAAiC;AAC7B;AACAa,YAAAA,aAAa,CAACI,IAAd,CAAmBuB,YAAY,CAACxC,CAAD,CAA/B;AACAa,YAAAA,aAAa,CAACI,IAAd,CAAmBuB,YAAY,CAACxC,CAAD,CAA/B;AACAP,YAAAA,OAAO,CAACC,GAAR,CAAYmB,aAAZ;AACH,WAdyB,CAe1B;;;AACAA,UAAAA,aAAa,GAAG5D,YAAY,CAAC4D,aAAD,CAA5B;AACA,iBAAOA,aAAP;AACH;;AAED1B,QAAAA,WAAW,GAAE;AACT;AACA;AACA,cAAI0D,YAAqB,GAAG,KAAKxD,IAAL,CAAUC,YAAV,CAAuB,WAAvB,CAA5B;AACA,cAAIwD,eAA6B,GAAG,KAAKzD,IAAL,CAAUC,YAAV,CAAuB,gBAAvB,CAApC;AACA,cAAIyD,WAAoB,GAAGD,eAAe,CAACE,WAAhB,CAA4B5C,KAAvD;AACA,cAAI6C,YAAqB,GAAGH,eAAe,CAACE,WAAhB,CAA4B3C,MAAxD;;AACA,cAAGwC,YAAY,CAACK,UAAb,IAA2BtF,MAAM,CAACuF,UAAP,CAAkBC,SAAhD,EAA0D;AACtD,gBAAIC,OAAgB,GAAGR,YAAY,CAACS,aAApC;AACA,iBAAKrE,SAAL,GAAiBoE,OAAjB;;AACA,gBAAG,KAAKxD,QAAL,IAAiBwD,OAApB,EAA4B;AACxB;AACA;AACA5D,cAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ,EAA6BqD,WAA7B,EAA0C,kBAA1C,EAA8DE,YAA9D;AACA,mBAAKjE,cAAL,GAAsB,CAAC+D,WAAW,GAAI,CAACM,OAAO,GAAG,CAAX,IAAgBR,YAAY,CAACU,QAA7C,IAA0DF,OAAhF,CAJwB,CAKxB;;AACA,kBAAIG,OAAgB,GAAGlG,IAAI,CAACmG,IAAL,CAAU,KAAK5D,QAAL,GAAgBwD,OAA1B,CAAvB;AACA5D,cAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ,EAA4B8D,OAA5B;AACA,mBAAKzE,eAAL,GAAuB,CAACkE,YAAY,GAAI,CAACO,OAAO,GAAG,CAAX,IAAgBX,YAAY,CAACa,QAA9C,IAA2DF,OAAlF;AACH,aATD,MASO;AACH;AACA;AACH;AACJ;AAEJ;;AA/PyC,O","sourcesContent":["import { _decorator, Component, instantiate, Layout, Node, Prefab, UITransform, Widget} from 'cc';\nimport { CCInteger } from 'cc'\nimport { CardScript } from './CardScript';\nimport { ScoreEvaluator } from './ScoreEvaluator';\nimport { CardSelectEvent } from './CardSelectEvent';\nimport { ScoreCounter } from './ScoreCounter';\nconst { ccclass, property } = _decorator;\n\n@ccclass('CardController')\nexport class CardController extends Component {\n    @property({type: Prefab, tooltip: \"Drag card prefab here\"})\n    CardPrefab : Prefab;\n\n    @property({type: CCInteger, tooltip: \"Number of cards\"})\n    NumCards : number;\n\n    ScoreEval : ScoreEvaluator;\n\n    // Queue for tracking card selection events  --  for now use array, change to actual queue later\n    // Stores ID of selected cards temporally, remove the first two on match/mismatch\n    CardSelectedQueue : Array<CardScript>;\n\n    // Number of cards currently selected\n    NumSelectedCards : number;\n\n    // Assuming that number of cards is even, there must be NumCards/2 unique pairs\n    // However, can have repeated pairs if run out of card types\n    // For now, use 5 card types \n\n    // Object to keep track of player score\n    ScoreCounter : ScoreCounter;\n\n    SaveState = {\n        score: 0,\n        combo: 0,\n        cards : [] as string[],\n        faceUpIndex: -1,\n        removedCards : [] as number[],\n        columnReq: 0\n    };\n\n    childCardHeight : number;\n    childCardWidth : number;\n\n    ColumnReq : number;\n\n    protected onLoad(): void {\n        this.getCardSize();\n    }\n    start() {\n        // Get requirements for card sizes and columns\n        this.getCardSize();\n        // Get the evaluator script\n        this.ScoreEval = this.node.getComponent(\"ScoreEvaluator\") as ScoreEvaluator;\n        // Get score tracker\n        this.ScoreCounter = this.node.getComponent(\"ScoreCounter\") as ScoreCounter;\n        // If save state exists and at least one pair is left\n        if((localStorage.getItem(\"saveState\")) ){\n            console.log(\"Fetched save data\");\n            this.SaveState = JSON.parse(localStorage.getItem(\"saveState\") as string);\n            if(this.SaveState.columnReq != this.ColumnReq){\n                console.log(\"Column req not met\");\n                this.getCardSize();\n            } else if(this.SaveState.cards.length != this.NumCards){\n                console.log(\"Num cards not met\");\n                this.getCardSize();\n            } else {\n                // parse from here\n                this.NumCards = this.SaveState.cards.length;\n                this.ScoreCounter.Score = this.SaveState.score;\n                this.ScoreCounter.ComboStreak = this.SaveState.combo;\n                for(let i = 0; i < this.NumCards; i++){\n                    const childCard = instantiate(this.CardPrefab);\n                    let childTransform : UITransform = \n                        childCard.getComponent(\"cc.UITransform\") as UITransform;\n                    childTransform.width = this.childCardWidth;\n                    childTransform.height = this.childCardHeight;\n                    this.node.addChild(childCard);\n                    let cardScript : CardScript = \n                        this.node.children[i].getComponent(\"CardScript\") as CardScript;\n                    cardScript.init(false, this.SaveState.cards[i], i);\n                    if(this.SaveState.faceUpIndex == i){\n                        cardScript.setFlipStatus(true);\n                    }\n                    if(this.SaveState.removedCards[i] == 1){\n                        cardScript.disable();\n                    }\n                 }\n                 // Setup listener for card selection events\n                this.setupCardMatchListener();\n                return;\n            }\n        }\n\n        // First make sure that numcards is an even number (cant make pairs with odd num)\n        if(this.NumCards % 2 != 0){\n            this.NumCards -= 1;\n        }\n        \n\n        // Get a random subset of card type pairs\n        let shuffledTypes : Array<String> = this.getCardTypes();\n\n        // Instantiate all cards\n        for (let i = 0; i < this.NumCards; i++){\n            const childCard = instantiate(this.CardPrefab);\n            let childTransform : UITransform = \n                childCard.getComponent(\"cc.UITransform\") as UITransform;\n            childTransform.width = this.childCardWidth;\n            childTransform.height = this.childCardHeight;\n            this.node.addChild(childCard);\n            let cardScript : CardScript = \n                    childCard.getComponent(\"CardScript\") as CardScript;\n            \n            cardScript.init(false, shuffledTypes[i], i); \n            // For layout adjustments\n            let widget : Widget = \n                    childCard.getComponent(\"cc.Widget\") as Widget;\n            widget.target = this.node;\n\n            // Save to save state\n            this.SaveState.cards.push(shuffledTypes[i] as string);\n            this.SaveState.removedCards.push(0);\n        }\n\n        // Setup listener for card selection events\n        this.setupCardMatchListener();\n    }\n\n    update(deltaTime: number) {\n    }\n\n    testGetChildren(){\n        this.node.children.forEach(childNode=> {\n            console.log(childNode.name);\n            let cardScript : CardScript = \n                        childNode.getComponent(\"CardScript\") as CardScript;\n            if(cardScript){\n                console.log(cardScript.CardType, cardScript.FlippedUp);\n            }\n            \n        });\n    }\n\n    setupCardMatchListener(){\n        this.CardSelectedQueue = new Array<CardScript>();\n        this.NumSelectedCards = 0;\n        this.node.on(\"card-selected\", (event : CardSelectEvent) => {\n            let card : CardScript = event.card;\n            // Stop event propagation\n            event.propagationStopped = true;  \n            console.log(\"SELECTED CARD ID: \", card.CardID, \" CARD TYPE: \",card.CardType);\n            // Handle animation logic here\n    \n            // Check if this card is already face up. If it is then early return\n            if(card.FlippedUp){\n                return;\n            }\n            // First add to queue\n            this.CardSelectedQueue.push(card);\n            this.NumSelectedCards++;\n            // If no other cards selected, can flip face up\n            if(this.NumSelectedCards == 1){\n                // Flip face up\n                card.setFlipStatus(true);\n                this.SaveState.faceUpIndex = card.CardID; // this works because the card id IS the index\n            } else if (this.NumSelectedCards > 1){\n                // By this point, two cards are selected\n                this.SaveState.faceUpIndex = -1;\n                card.setFlipStatus(true);\n                let score : number = this.ScoreEval.getScore(\n                    this.CardSelectedQueue[0].CardType,\n                    card.CardType\n                );\n                console.log(\"Score: \", score);\n                \n                // Pass score to score counter\n                this.ScoreCounter.trackScore(score);\n                // For save state\n                this.SaveState.score = this.ScoreCounter.Score;\n                this.SaveState.combo = this.ScoreCounter.ComboStreak;\n                // Save combo to save state\n                if(score <= 0){\n                    // Mismatch\n                    this.SaveState.combo = 0;\n                    // Do delay, then flip both cards face down\n                    this.CardSelectedQueue[0].setFlipStatus(false);\n                    card.setFlipStatus(false);\n                    \n                } else {\n                    // Match\n    \n                    // Do delay, then disable both cards from rendering\n                    this.CardSelectedQueue[0].disable();\n                    card.disable();\n\n                    // Add disabled cards to save state\n                    this.SaveState.removedCards[this.CardSelectedQueue[0].CardID] = 1;\n                    this.SaveState.removedCards[card.CardID] = 1;\n                }\n                // Eject the first two queue entries which are the two selected cards\n                this.NumSelectedCards -= 2;\n                this.CardSelectedQueue.shift();\n                this.CardSelectedQueue.shift();\n    \n            } else {\n                console.log(\"ERROR: Num selected cards: \", this.NumSelectedCards);\n            }\n            console.log(this.SaveState);\n            \n            // if all cards are removed, no need to save state as game is over\n            if(this.SaveState.removedCards.every((val) => val == 1)){\n                localStorage.removeItem(\"saveState\");\n            } else {\n                localStorage.setItem(\"saveState\", JSON.stringify(this.SaveState));\n            }\n        });\n    }\n\n    getCardTypes() : Array<String>{\n        // From the score evaluator, get the list of scoring card types\n        let scoringTypes : Array<String> = Array.from(this.ScoreEval.scoreHashMap.keys());\n        scoringTypes = shuffleArray(scoringTypes);\n        console.log(scoringTypes);\n        let numTypes : number = this.NumCards / 2;\n        let shuffledTypes : Array<String> = new Array<String>();\n        // Get the first numTypes shuffled types from the evaluator, and only use those for this game\n        console.log(shuffledTypes);\n        for(let i = 0; i < numTypes; i++){\n            // Push twice since we need pairs\n            shuffledTypes.push(scoringTypes[i]);\n            shuffledTypes.push(scoringTypes[i]);\n            console.log(shuffledTypes);\n        }\n        //console.log(shuffledTypes);\n        shuffledTypes = shuffleArray(shuffledTypes);\n        return shuffledTypes;\n    }\n\n    getCardSize(){\n        // For NumCards, adjust the size of the cell such that they fit perfectly in the container\n        // Need to reference the column constraint \n        let parentLayout : Layout = this.node.getComponent(\"cc.Layout\") as Layout;\n        let parentTransform : UITransform = this.node.getComponent(\"cc.UITransform\") as UITransform;\n        let parentWidth : number = parentTransform.contentSize.width;\n        let parentHeight : number = parentTransform.contentSize.height;\n        if(parentLayout.constraint == Layout.Constraint.FIXED_COL){\n            let numCols : number = parentLayout.constraintNum;\n            this.ColumnReq = numCols;\n            if(this.NumCards >= numCols){\n                // Have to be the full size\n                // Adjust width to fit\n                console.log(\"Parent width \", parentWidth, \", parent height \", parentHeight);\n                this.childCardWidth = (parentWidth - ((numCols - 1) * parentLayout.spacingX)) / numCols;\n                // Adjust height to fit\n                let numRows : number = Math.ceil(this.NumCards / numCols);\n                console.log(\"Num rows is \", numRows);\n                this.childCardHeight = (parentHeight - ((numRows - 1) * parentLayout.spacingY)) / numRows;\n            } else {\n                // Grow the children\n                return;\n            }\n        }\n\n    }\n}\n\n// Using the Fisher-Yates shuffle to shuffle an array\nfunction shuffleArray<T>(array: T[]): T[] {\n    let currentIndex = array.length, randomIndex;\n  \n    // While there remain elements to shuffle.\n    while (currentIndex !== 0) {\n  \n      // Pick a remaining element.\n      randomIndex = Math.floor(Math.random() * currentIndex);\n      currentIndex--;\n  \n      // And swap it with the current element.\n      [array[currentIndex], array[randomIndex]] = [\n        array[randomIndex], array[currentIndex]];\n    }\n  \n    return array;\n  }\n"]}